# ğŸŒŠ æµå¼è¾“å‡ºåŠŸèƒ½ | Streaming Output Feature

## âœ¨ åŠŸèƒ½æ¦‚è¿°

ç°åœ¨æ™ºèƒ½ä½“æ”¯æŒ**å®æ—¶æµå¼è¾“å‡º**ï¼Œæ‚¨å¯ä»¥ï¼š
- ğŸ“ **å®æ—¶çœ‹åˆ°æ€è€ƒè¿‡ç¨‹** - LLMè¾¹æ€è€ƒè¾¹æ˜¾ç¤º
- ğŸ› ï¸ **ç«‹å³çœ‹åˆ°å·¥å…·è°ƒç”¨** - å·¥å…·æ‰§è¡Œè¿‡ç¨‹å³æ—¶å¯è§
- âš¡ **æ— éœ€ç­‰å¾…** - ä¸ç”¨ç­‰æ‰€æœ‰æ¨ç†å®Œæˆæ‰çœ‹åˆ°ç»“æœ
- ğŸ”„ **å®Œæ•´çš„è¿­ä»£è¿‡ç¨‹** - æ¯ä¸€è½®æ¨ç†éƒ½æ¸…æ™°å¯è§

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. **LLMå®¢æˆ·ç«¯æµå¼æ”¯æŒ** (`core/llm_client.py`)
- âœ… æ·»åŠ äº† `parse_stream()` æ–¹æ³•è§£æSSEæµ
- âœ… `_openai_chat()` æ”¯æŒ `stream=True` å‚æ•°
- âœ… è¿”å›å“åº”å¯¹è±¡ä¾›è¿­ä»£ä½¿ç”¨

### 2. **Agentæµå¼æ‰§è¡Œ** (`core/agent.py`)
- âœ… æ–°å¢ `run_stream()` æ–¹æ³•
- âœ… ä½¿ç”¨ `yield` å®æ—¶äº§ç”Ÿäº‹ä»¶
- âœ… æ”¯æŒå¤šç§äº‹ä»¶ç±»å‹ï¼š
  - `iteration` - è¿­ä»£è½®æ¬¡
  - `thought_start/chunk/end` - æ€è€ƒè¿‡ç¨‹
  - `tool_call` - å·¥å…·è°ƒç”¨
  - `tool_result` - å·¥å…·ç»“æœ
  - `final_answer` - æœ€ç»ˆç­”æ¡ˆ
  - `error` - é”™è¯¯ä¿¡æ¯

### 3. **Streamlitç•Œé¢å®æ—¶æ›´æ–°** (`gui/app.py`)
- âœ… ä½¿ç”¨ `st.empty()` åˆ›å»ºå ä½ç¬¦
- âœ… é€å—æ›´æ–°æ˜¾ç¤ºå†…å®¹
- âœ… æ·»åŠ é—ªçƒå…‰æ ‡æ•ˆæœ `â–Œ`
- âœ… æ ¼å¼åŒ–ä¸åŒäº‹ä»¶ç±»å‹

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

```
ğŸ”„ ç¬¬ 1 è½®æ¨ç†...

ğŸ’­ æ€è€ƒä¸­: {"thought": "ç”¨æˆ·è¦è®¡ç®—1234ä¹˜ä»¥5234ï¼Œç„¶åå¼€ä¸‰æ¬¡æ–¹...", "action": "MathCalculator", ...}

ğŸ› ï¸  è°ƒç”¨å·¥å…·: MathCalculator
   å‚æ•°: {"expression": "1234 * 5234"}

ğŸ“Š å·¥å…·ç»“æœ: {"result": 6458756}

ğŸ”„ ç¬¬ 2 è½®æ¨ç†...

ğŸ’­ æ€è€ƒä¸­: {"thought": "ç°åœ¨éœ€è¦å¯¹6458756å¼€ä¸‰æ¬¡æ–¹...", "action": "MathCalculator", ...}

ğŸ› ï¸  è°ƒç”¨å·¥å…·: MathCalculator
   å‚æ•°: {"expression": "6458756 ** (1/3)"}

ğŸ“Š å·¥å…·ç»“æœ: {"result": 186.24...}

ğŸ”„ ç¬¬ 3 è½®æ¨ç†...

ğŸ’­ æ€è€ƒä¸­: {"thought": "è®¡ç®—å®Œæˆï¼Œå¯ä»¥ç»™å‡ºæœ€ç»ˆç­”æ¡ˆäº†", "final_answer": "..."}

âœ… æœ€ç»ˆç­”æ¡ˆ: 1234ä¹˜ä»¥5234ç­‰äº6458756ï¼Œå¼€ä¸‰æ¬¡æ–¹çº¦ä¸º186.24
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
cd python-agent-framework
python3 test_streaming.py
```

### æ–¹æ³•2: åœ¨Streamlitä¸­æµ‹è¯•

1. åˆ·æ–°æµè§ˆå™¨
2. åˆ›å»ºæ–°çš„å¯ç”¨ReActçš„æ™ºèƒ½ä½“
3. åœ¨èŠå¤©ç•Œé¢è¾“å…¥æµ‹è¯•ä»»åŠ¡
4. è§‚å¯Ÿå®æ—¶è¾“å‡º

## ğŸ¨ äº‹ä»¶ç±»å‹è¯´æ˜

| äº‹ä»¶ç±»å‹ | è§¦å‘æ—¶æœº | æ˜¾ç¤ºå†…å®¹ |
|---------|---------|---------|
| `iteration` | å¼€å§‹æ–°ä¸€è½®æ¨ç† | ğŸ”„ ç¬¬ X è½®æ¨ç†... |
| `thought_start` | å¼€å§‹æ€è€ƒ | ğŸ’­ æ€è€ƒä¸­: |
| `thought_chunk` | æµå¼æ€è€ƒç‰‡æ®µ | (é€å­—æ˜¾ç¤º) |
| `thought_end` | æ€è€ƒç»“æŸ | \n |
| `tool_call` | è°ƒç”¨å·¥å…· | ğŸ› ï¸ è°ƒç”¨å·¥å…·: åç§°\nå‚æ•°: {...} |
| `tool_result` | å·¥å…·è¿”å› | ğŸ“Š å·¥å…·ç»“æœ: {...} |
| `final_answer` | å¾—å‡ºæœ€ç»ˆç­”æ¡ˆ | âœ… æœ€ç»ˆç­”æ¡ˆ: ... |
| `error` | å‘ç”Ÿé”™è¯¯ | âŒ é”™è¯¯: ... |
| `max_iterations` | è¶…è¿‡æœ€å¤§è¿­ä»£ | âš ï¸ è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•° |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### SSEæµè§£æ

```python
def parse_stream(self, response):
    for line in response.iter_lines():
        if line:
            line = line.decode('utf-8')
            if line.startswith('data: '):
                data = line[6:]
                if data == '[DONE]':
                    break
                chunk = json.loads(data)
                if 'choices' in chunk:
                    delta = chunk['choices'][0].get('delta', {})
                    if 'content' in delta:
                        yield delta['content']
```

### Streamlitå®æ—¶æ›´æ–°

```python
message_placeholder = st.empty()
full_response = ""

for event in agent.run_stream(user_input):
    if event["type"] == "thought_chunk":
        full_response += event["content"]
        message_placeholder.markdown(full_response + "â–Œ")  # é—ªçƒå…‰æ ‡
```

## âš¡ æ€§èƒ½ä¼˜åŠ¿

- **å“åº”æ›´å¿«** - ç¬¬ä¸€ä¸ªå­—ç¬¦ç«‹å³æ˜¾ç¤ºï¼Œä¸ç”¨ç­‰å®Œæ•´å“åº”
- **ä½“éªŒæ›´å¥½** - ç”¨æˆ·çŸ¥é“ç³»ç»Ÿåœ¨å·¥ä½œï¼Œä¸ä¼šè§‰å¾—å¡æ­»
- **è°ƒè¯•å‹å¥½** - å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥çš„æ€è€ƒå’Œå·¥å…·è°ƒç”¨
- **é€æ˜åº¦é«˜** - å®Œæ•´çš„æ¨ç†è¿‡ç¨‹éƒ½å¯è§

## ğŸ”„ å…¼å®¹æ€§

- âœ… å®Œå…¨å‘åå…¼å®¹ - æ—§çš„ `run()` æ–¹æ³•ä»ç„¶å¯ç”¨
- âœ… æ–°çš„ `run_stream()` æä¾›æµå¼ä½“éªŒ
- âœ… Streamlitè‡ªåŠ¨å¤„ç†æµå¼æ›´æ–°
- âœ… æ”¯æŒæ‰€æœ‰ReActæ ¼å¼å’Œå·¥å…·

## ğŸ“ ä½¿ç”¨å»ºè®®

1. **å¤æ‚ä»»åŠ¡ä¼˜å…ˆä½¿ç”¨æµå¼** - å¤šæ­¥æ¨ç†æ—¶ä½“éªŒæ›´å¥½
2. **ç®€å•æŸ¥è¯¢å¯ç”¨æ™®é€šæ¨¡å¼** - å•æ¬¡å“åº”æ—¶æ— éœ€æµå¼
3. **è§‚å¯Ÿå®Œæ•´è¿‡ç¨‹** - æœ‰åŠ©äºç†è§£æ™ºèƒ½ä½“å¦‚ä½•è§£å†³é—®é¢˜
4. **è°ƒè¯•æ—¶å¾ˆæœ‰ç”¨** - èƒ½çœ‹åˆ°æ¯ä¸€æ­¥çš„å†³ç­–

## ğŸ‰ ç°åœ¨å°±è¯•è¯•ï¼

åˆ·æ–°Streamlité¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ™ºèƒ½ä½“ï¼Œè¯•è¯•è¿™äº›ä»»åŠ¡ï¼š

1. "è®¡ç®— 1234 * 5234 ç„¶åå¼€ä¸‰æ¬¡æ–¹"
2. "ç”Ÿæˆä¸€ä¸ª10ä¸ªéšæœºæ•°çš„åˆ—è¡¨å¹¶è®¡ç®—å®ƒä»¬çš„å¹³å‡å€¼"
3. "ç”¨Pythonæ‰“å°å‰20ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—"

ä½ ä¼šå®æ—¶çœ‹åˆ°æ™ºèƒ½ä½“çš„æ€è€ƒã€å·¥å…·è°ƒç”¨å’Œç»“æœï¼ğŸš€
